{% extends 'front.html.twig' %}

{% block title %}Les Reservations{% endblock %}

{% block body %}

    <div class="card mb-4">
    <div class="card-header">
        Les Reservations
    </div>
    <div class="card-body">
        <table class="table">
            <thead>
            <tr>
                <th>
                    nom : Prenom client
                </th>
                <th>
                    title chambre
                </th>
                <th>
                    prix chambre
                </th>
                <th>
                    Quantite
                </th>
                <th>
                    Prix Total
                </th>
                <th>
                    Date Debut
                </th>
                <th>
                    Date Fin
                </th>
            </tr>
            </thead>
            <tbody>
            {% for r in reservation %}
                <tr>
                    {% if app.user %}
                        {% if  r.utilisateur.id == app.user.id %}
                            <td>{{ r.utilisateur.nom~" " ~ r.utilisateur.prenom }}</td>
                            <td>{{ r.chambre.title }}</td>
                            <td>{{ r.chambre.prix }}</td>
                            <td>{{ r.quantite }}</td>
                            <td>{{ r.quantite * r.chambre.prix  }}</td>
                            <td>{{ r.datedebut | date('Y-m-D') }}</td>
                            <td>{{ r.datefin | date('Y-m-D') }}</td>
                            <td><div class="badge badge-success">Reserv√©</div></td>
                            <td><a class="btn btn-primary"  href="{{ path('pdf',{'id' : r.id}) }}">pdf</a></td>
                            <td>
                                <button class="btn btn-primary" id="checkout-button">Checkout</button>
                            </td>
                        {% endif%}
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <script src="{{ asset('https://js.stripe.com/v3/')}}"></script>
    <script>
        // Create an instance of the Stripe object with your publishable API key
        var stripe = Stripe('pk_test_51ITrmKDemurknTpxNogaH6qwkkX1HK7bxuSwQU2CGyorqtm0u4sXCrbYFAsbFLTRv1tZPANLJCzSiKCxL40xQXi90040tZxsuX');
        var checkoutButton = document.getElementById('checkout-button');
        checkoutButton.addEventListener('click', function() {
            // Create a new Checkout Session using the server-side endpoint you
            // created in step 3.
            fetch('/reservation/create-checkout-session', {
                method: 'POST',
            })
                .then(function(response) {
                    return response.json();
                })
                .then(function(session) {
                    return stripe.redirectToCheckout({ sessionId: session.id });
                })
                .then(function(result) {
                    // If `redirectToCheckout` fails due to a browser or network
                    // error, you should display the localized error message to your
                    // customer using `error.message`.
                    if (result.error) {
                        alert(result.error.message);
                    }
                })
                .catch(function(error) {
                    console.error('Error:', error);
                });
        });
    </script>
{% endblock %}